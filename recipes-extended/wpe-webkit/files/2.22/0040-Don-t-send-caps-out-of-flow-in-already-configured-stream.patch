From 0e09d4c0413dcbdb4a5563bc0ae332a81bd95d49 Mon Sep 17 00:00:00 2001
From: Siva Sankar Raja <sivasankar_raja@comcast.com>
Source: COMCAST
License: LICENSE-LGPL-2.1
Upstream-Status: Pending
Signed-off-by: Siva Sankar Raja <sivasankar_raja@comcast.com>
Date: Fri, 5 Jul 2019 17:26:22 +0000
Subject: [PATCH] Don't send caps out of flow in already configured
 stream

---
 Source/WebCore/platform/graphics/gstreamer/mse/PlaybackPipeline.cpp | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

Index: git/Source/WebCore/platform/graphics/gstreamer/mse/PlaybackPipeline.cpp
===================================================================
--- git.orig/Source/WebCore/platform/graphics/gstreamer/mse/PlaybackPipeline.cpp
+++ git/Source/WebCore/platform/graphics/gstreamer/mse/PlaybackPipeline.cpp
@@ -166,6 +166,7 @@ void PlaybackPipeline::attachTrack(RefPt
 
     GST_OBJECT_LOCK(webKitMediaSrc);
     Stream* stream = getStreamBySourceBufferPrivate(webKitMediaSrc, sourceBufferPrivate.get());
+    bool allTracksConfigured = webKitMediaSrc->priv->allTracksConfigured;
     GST_OBJECT_UNLOCK(webKitMediaSrc);
 
     ASSERT(stream);
@@ -215,7 +216,7 @@ void PlaybackPipeline::attachTrack(RefPt
     if (signal != -1)
         g_signal_emit(G_OBJECT(stream->parent), webKitMediaSrcSignals[signal], 0, nullptr);
 
-    if (caps) {
+    if (caps && !allTracksConfigured) {
         // Set caps to trigger early pipeline initialization
         gst_app_src_set_caps(GST_APP_SRC(stream->appsrc), caps);
 
