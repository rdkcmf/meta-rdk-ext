From 0f369c5717d8f649383b459f729f30e0f9c2007e Mon Sep 17 00:00:00 2001
From: Siva Sankar Raja <sivasankar_raja@comcast.com>
Source: COMCAST
License: LICENSE-LGPL-2.1
Upstream-Status: Pending
Signed-off-by: Siva Sankar Raja <sivasankar_raja@comcast.com>
Date: Fri, 5 Jul 2019 11:28:11 +0000
Subject: [PATCH] Defer seek complition until it is actually finished

---
 .../graphics/gstreamer/MediaPlayerPrivateGStreamer.cpp     | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

Index: git/Source/WebCore/platform/graphics/gstreamer/MediaPlayerPrivateGStreamer.cpp
===================================================================
--- git.orig/Source/WebCore/platform/graphics/gstreamer/MediaPlayerPrivateGStreamer.cpp
+++ git/Source/WebCore/platform/graphics/gstreamer/MediaPlayerPrivateGStreamer.cpp
@@ -1360,6 +1360,12 @@ void MediaPlayerPrivateGStreamer::handle
 
         if (!messageSourceIsPlaybin || m_delayingLoad)
             break;
+
+        if (m_seeking)
+        {
+            asyncStateChangeDone();
+        }
+
         updateStates();
 
         // Construct a filename for the graphviz dot file output.
@@ -2007,6 +2013,14 @@ void MediaPlayerPrivateGStreamer::asyncS
         if (m_seekIsPending)
             updateStates();
         else {
+            GstState state, newState;
+            GstStateChangeReturn getStateResult = gst_element_get_state(m_pipeline.get(), &state, &newState,0);
+            if (getStateResult == GST_STATE_CHANGE_ASYNC
+                && !(state == GST_STATE_PLAYING && newState == GST_STATE_PAUSED)) {
+                GST_DEBUG("[Seek] Delaying seek finish");
+                return;
+            }
+
             GST_DEBUG("[Seek] seeked to %s", toString(m_seekTime).utf8().data());
             m_seeking = false;
             m_cachedPosition = MediaTime::invalidTime();
