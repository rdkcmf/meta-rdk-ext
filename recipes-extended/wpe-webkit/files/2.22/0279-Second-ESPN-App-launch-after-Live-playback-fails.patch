From 3a923e75ce27990f5f9f247778f68da9b4480cad Mon Sep 17 00:00:00 2001
From: "Vivek.A" <Vivek_Arumugam@comcast.com>
Date: Mon, 2 Aug 2021 18:03:42 +0000
Subject: [PATCH] Second ESPN App launch after Live playback fails

Change-Id: Id25e5ab63fd002aa7260bbac00b504767ab6b89c
---
 .../graphics/texmap/TextureMapperGC3DPlatformLayer.cpp | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/Source/WebCore/platform/graphics/texmap/TextureMapperGC3DPlatformLayer.cpp b/Source/WebCore/platform/graphics/texmap/TextureMapperGC3DPlatformLayer.cpp
index 0359cf4a0159..94ef052ec208 100644
--- a/Source/WebCore/platform/graphics/texmap/TextureMapperGC3DPlatformLayer.cpp
+++ b/Source/WebCore/platform/graphics/texmap/TextureMapperGC3DPlatformLayer.cpp
@@ -61,9 +61,13 @@ TextureMapperGC3DPlatformLayer::~TextureMapperGC3DPlatformLayer()
         client()->platformLayerWillBeDestroyed();
 //#endif
 
-    if (m_renderStyle == GraphicsContext3D::RenderDirectlyToHostWindow && (s_windowContextRefCount - 1) == 0) {
-        s_windowContextRefCount = 0;
-        s_windowContext.reset();
+    if (m_renderStyle == GraphicsContext3D::RenderDirectlyToHostWindow) {
+        if ((s_windowContextRefCount - 1) == 0) {
+            s_windowContextRefCount = 0;
+            s_windowContext.reset();
+        } else {
+            s_windowContextRefCount--;
+        }
     }
 }
 
@@ -81,7 +85,7 @@ GLContext* TextureMapperGC3DPlatformLayer::glContext()
 
 bool TextureMapperGC3DPlatformLayer::makeContextCurrent()
 {
-    return glContext()->makeContextCurrent();
+    return glContext() && glContext()->makeContextCurrent();
 }
 
 PlatformGraphicsContext3D TextureMapperGC3DPlatformLayer::platformContext()
-- 
2.25.1

