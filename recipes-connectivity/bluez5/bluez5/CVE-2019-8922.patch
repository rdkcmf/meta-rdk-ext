From 6c7243fb6ab90b7b855cead98c66394fedea135f Mon Sep 17 00:00:00 2001
From: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Date: Fri, 28 Sep 2018 16:08:32 +0300
Subject: sdp: Fix buffer overflow

Description: sdp_append_buf shall check if there is enough space to store the data
before copying it.

Marc Deslauriers <marc.deslauriers@ubuntu.com>  Wed, 08 Dec 2021 07:57:30
---
Index: bluez-5.48/lib/sdp.c
===================================================================
--- bluez-5.48.orig/lib/sdp.c
+++ bluez-5.48/lib/sdp.c
@@ -2834,6 +2834,12 @@ void sdp_append_to_buf(sdp_buf_t *dst, u
 	SDPDBG("Append src size: %d", len);
 	SDPDBG("Append dst size: %d", dst->data_size);
 	SDPDBG("Dst buffer size: %d", dst->buf_size);
+
+	if (dst->data_size + len > dst->buf_size) {
+		SDPERR("Cannot append");
+		return;
+	}
+
 	if (dst->data_size == 0 && dtd == 0) {
 		/* create initial sequence */
 		*p = SDP_SEQ8;
